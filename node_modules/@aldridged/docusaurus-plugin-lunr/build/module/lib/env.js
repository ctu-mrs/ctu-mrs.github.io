import fs from 'fs-extra';
import path from 'path';
import { head, size } from 'lodash/fp';
import { VERSIONED_DOCS_DIR, VERSIONS_JSON_FILE } from './constants';
const VERSION_OPTIONS_DISABLED = {
    versioning: {
        docsDir: '',
        enabled: false,
        latestVersion: null,
        versions: [],
    }
};
function getVersionedDocsDir(siteDir) {
    return path.join(siteDir, VERSIONED_DOCS_DIR);
}
function getVersionsJSONFile(siteDir) {
    return path.join(siteDir, VERSIONS_JSON_FILE);
}
function getVersions(siteDir) {
    const versionsJSONFile = getVersionsJSONFile(siteDir);
    return fs.existsSync(versionsJSONFile) ? JSON.parse(fs.readFileSync(versionsJSONFile, 'utf8')) : [];
}
function getOptions(siteDir, versions) {
    return {
        versioning: {
            docsDir: getVersionedDocsDir(siteDir),
            enabled: true,
            latestVersion: head(versions),
            versions,
        }
    };
}
export default function (siteDir) {
    const versions = getVersions(siteDir);
    return size(versions) ? getOptions(siteDir, versions) : VERSION_OPTIONS_DISABLED;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9lbnYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzFCLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUV4QixPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUV2QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHckUsTUFBTSx3QkFBd0IsR0FBRztJQUMvQixVQUFVLEVBQUU7UUFDVixPQUFPLEVBQUUsRUFBRTtRQUNYLE9BQU8sRUFBRSxLQUFLO1FBQ2QsYUFBYSxFQUFFLElBQUk7UUFDbkIsUUFBUSxFQUFFLEVBQUU7S0FDYjtDQUNGLENBQUM7QUFFRixTQUFTLG1CQUFtQixDQUFDLE9BQWU7SUFDMUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUFDLE9BQWU7SUFDMUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFFRCxTQUFTLFdBQVcsQ0FBQyxPQUFlO0lBQ2xDLE1BQU0sZ0JBQWdCLEdBQUcsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdEQsT0FBTyxFQUFFLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDdEcsQ0FBQztBQUVELFNBQVMsVUFBVSxDQUFDLE9BQWUsRUFBRSxRQUErQjtJQUNsRSxPQUFPO1FBQ0wsVUFBVSxFQUFFO1lBQ1YsT0FBTyxFQUFFLG1CQUFtQixDQUFDLE9BQU8sQ0FBQztZQUNyQyxPQUFPLEVBQUUsSUFBSTtZQUNiLGFBQWEsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQzdCLFFBQVE7U0FDVDtLQUNGLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxDQUFDLE9BQU8sV0FBVyxPQUFlO0lBQ3RDLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUM7QUFDbkYsQ0FBQyJ9